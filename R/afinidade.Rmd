---
title: "afinidade"
output: html_document
---

Monta um ranking com os deputados mais próximos para cada deputado

```{r}
library(e1071)
library(tidyr)

source("R/camara-lib.R")
```

Carrega os dados

```{r}
votos_por_deputado1 <- recuperar_votos_por_deputado(arquivo.votos = "dados/votacoes.csv", corrigir.migracoes = TRUE)


votos_por_deputado <- head(votos_por_deputado1)


rownames(votos_por_deputado) <- votos_por_deputado$id_dep

votos_por_deputado <- votos_por_deputado[,5:ncol(votos_por_deputado)]

votos_por_deputado[] <- lapply(votos_por_deputado, as.character)
votos_por_deputado[is.na(votos_por_deputado)] <- 0
votos_por_deputado <- as.matrix(votos_por_deputado)

votos_por_deputado <- as.data.frame(hamming.distance(votos_por_deputado))

top_afinidade <- as.data.frame(cbind(row.names(votos_por_deputado), apply(votos_por_deputado, 1, function(x) names(votos_por_deputado)[which(x == min(x))])))

top_not_afinidade <- as.data.frame(cbind(row.names(votos_por_deputado), apply(votos_por_deputado, 1, function(x) names(votos_por_deputado)[which(x == max(x))])))

n <- length(votos_por_deputado)

top_not_afinidade_2 <- as.data.frame(cbind(row.names(votos_por_deputado), apply(votos_por_deputado, 1, function(x) names(votos_por_deputado)[which(x == max(sort(x,partial=n-1)[n-1]))])))

top_not_afinidade_3 <- as.data.frame(cbind(row.names(votos_por_deputado), apply(votos_por_deputado, 1, function(x) names(votos_por_deputado)[which(x == max(sort(x,partial=n-2)[n-2]))])))

top_not_afinidade_4 <- as.data.frame(cbind(row.names(votos_por_deputado), apply(votos_por_deputado, 1, function(x) names(votos_por_deputado)[which(x == max(sort(x,partial=n-3)[n-3]))])))

top_not_afinidade_5 <- as.data.frame(cbind(row.names(votos_por_deputado), apply(votos_por_deputado, 1, function(x) names(votos_por_deputado)[which(x == max(sort(x,partial=n-4)[n-4]))])))


l1 <- sapply(top_not_afinidade$V2, length)
unlist.col1 <- rep(top_not_afinidade$V1, l1)
id_dep <- unlist(unlist.col1)

not_afinidade <- unnest(top_not_afinidade, V2)

df_not_afinidade <- cbind(id_dep, not_afinidade)
df_not_afinidade$id_dep <- as.integer(as.character(df_not_afinidade$id_dep))

MCA_new <- read.csv("~/Projetos/houseofcunha-interface/graficos/MCA_new.csv")

toPlot <- left_join(MCA_new, df_not_afinidade, by = "id_dep")

toPlot$not_afinidade <- toPlot$V2
toPlot$V2 <- NULL

write.csv2(toPlot, file = "~/Projetos/houseofcunha-interface/graficos/MCA_new.csv", row.names = FALSE)

# TO DO ARRUMAR O CÓDIGO E MELHORAR A FUNÇÃO

```
